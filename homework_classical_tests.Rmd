---
title: "Проверка гипотез. Классические статистические тесты"
author: "Jelena Čuklina & Maria Chernigovskaya & Alexey Glazkov"
date: "Октябрь 2025"
output:
  html_document: default
---

# Настройка

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# Установка seed для воспроизводимости
set.seed(42)
```

```{r load-packages}
library(dplyr)
library(ggplot2)
library(epitools)
# Предполагаем, что используется пакет NHANES для получения набора данных
library(NHANES)
```

В этом упражнении мы будем использовать набор данных NHANES (Национальное обследование здоровья и питания), который доступен через пакет NHANES. Эти данные содержат информацию о здоровье и питании населения США и широко используются для статистического анализа в области здравоохранения.

Подробное описание данных можно найти тут: https://cran.r-project.org/web/packages/NHANES/NHANES.pdf

```{r load-data}
# Загрузка набора данных NHANES (из пакета NHANES)
data(NHANES)
```

Подготовка чистого набора данных для анализа

```{r prepare-data}
# Фокус на ключевых переменных для упражнения
nhanes_clean <- NHANES %>%
  select(Gender, Age, BMI, Diabetes, BPSysAve, BPDiaAve, PhysActive, SleepTrouble, Height, Weight, Education, HHIncome) %>%
  # Удаление строк с отсутствующими данными для упрощения в этих упражнениях
  na.omit() %>%
  # Фильтрация для возраста >= 18 для исследований взрослых
  filter(Age >= 18)

# Проверка структуры данных для студентов
cat("Структура чистого набора данных NHANES (взрослые, >=18 лет):\n")
str(nhanes_clean)

summary(nhanes_clean)
```

------------------------------------------------------------------------

# Тесты для непрерывных данных

## Параметрические тесты

### 1: сравнение ИМТ с историческим средним

На основе исторических данных среднее значение ИМТ (BMI) для взрослых в США составляет **28.5**. ИМТ (индекс массы тела) рассчитывается как масса в килограммах, делённая на квадрат роста в метрах: BMI = weight (kg) / height (m)\^2. Вопрос исследования: отличается ли среднее значение ИМТ в популяции взрослых (возраст ≥ 18) от исторического значения **28.5**?

#### Задания:

##### Задание 1.1

Сформурируйте нулевую гипотезу и альтернативную гипотезу

-   $H_0$: *Среднее значение ИМТ в выборке равно 28.5*
-   $H_a$: *Среднее значение ИМТ в выборке больше или меньше 28.5*

##### Задание 1.2

Посчитайте ключевые статистики (среднее, стандартное отклонение, размер выборки) для переменной BMI в вашем чистом наборе данных `nhanes_clean`.

```{r descriptive-stats-bmi}
# Расчет ключевых статистик для BMI
mean_bmi = mean(nhanes_clean$BMI) # Среднее значение BMI

sd_bmi = sd(nhanes_clean$BMI) # Стандартное отклонение BMI

n_bmi = length(nhanes_clean$BMI) # размер выборки BMI

```

##### Задание 1.3

Выберите подходящий статистический тест для проверки гипотез из задания 1.1 и объясните свой выбор.

*Одновыборочный двухсторонний t-test. Группа у нас только одна, сравниваем с историческим значением. Направление эффекта заранее не знаем, поэтому тест двухсторонний.*

##### Задание 1.4

Используя выбранный тест, проверьте гипотезы из задания 1.1 на уровне значимости α = 0.1.

```{r test-bmi}
# 
mu_0_bmi <- 28.5

# Выполнение теста
test_BMI <-  t.test(
  x = nhanes_clean$BMI,
  mu = mu_0_bmi,
  alternative = "two.sided",
  conf.level = 0.9
)

print(test_BMI) 
```

##### Задание 1.5

Как p-значение и 90% доверительный интервал информируют вас об общем статусе ИМТ этой популяции относительно среднего значения в общей популяции в 28.5? Что вы можете сказать про статистическую значимость?

*90% CI (28.7; 29.0) говорит о том, что с вероятностью 95% истинное значение ИМТ в исследуемой популяции находится в данной интервале. Данный CI не захватывает исторической значение 28.5. p-value = 1.414e-05 указывает на статистически значимый результат (разницу среднего ИМТ в популяции и исторического значения). Следовательно, можно отвергнуть нулевую гипотезу о том, что среднее значение ИМТ в выборке равно 28.5*

### 2. Сравнение давления у мужчин и женщин

Сценарий: Исследователи хотят сравнить систолическое артериальное давление у мужчин и женщин. Вопрос исследования: Есть ли статистически значимая разница в среднем систолическом артериальном давлении ($\mathbf{BPSysAve}$) между **мужчинами** и **женщинами**?

##### Задание 2.1

Сформулируйте нулевую и альтернативную гипотезы

-   $H_0$: *(ответ студента)*
-   $H_a$: *(ответ студента)*

Подумайте, имеет ли значение, в какой группе давление больше

##### Задание 2.2

Посчитайте ключевые статистики (среднее в каждой группе, стандартное отклонение, размер каждой группы) для переменной `BPSysAve` в вашем чистом наборе данных `nhanes_clean`. Группы определяются переменной `Gender`.

```{r stats-BPSysAve}
... # вставьте ваш код
```

##### **Задание 2.3**

Выберите подходящий статистический тест для проверки гипотез из задания 2.1 и объясните свой выбор.

*(тут будет ответ студента)*

##### **Задание 2.4**

Используя выбранный тест, проверьте гипотезы из задания 2.1 на уровне значимости α = 0.1.

```{r BPSysAve-test}
# Выполнение теста


# test_BPSysAve <- ...(...
#   data = nhanes_clean,
#   ...
#   var.equal = FALSE # var.equal = FALSE использует поправку Уэлча (рекомендуется)
# )

print(test_BPSysAve)

```

##### Задание 2.5

Как p-значение и 90% доверительный интервал информируют вас о разнице измеренного артериального давления между мужчинами и женщинами? Что вы можете сказать про статистическую значимость?

### 3: Сравнение систолического и диастолического давления

Сценарий: Измерения систолического ($\mathbf{BPSysAve}$) и диастолического ($\mathbf{BPDiaAve}$) давления не являются независимыми. Вопрос исследования: Равна ли нулю средняя **разница** между систолическим ($\mathbf{BPSysAve}$) и диастолическим ($\mathbf{BPDiaAve}$) давлением (пульсовое давление) в исследуемой популяции?

##### Задание 3.1

Сформулируйте нулевую и альтернативную гипотезы

-   $H_0$: *(ответ студента)*
-   $H_a$: *(ответ студента)*

Подумайте, имеет ли значение, в какой группе давление больше

##### Задание 3.2

Посчитайте ключевые статистики для переменной `BPSysAve` и `BPDiaAve` в вашем чистом наборе данных `nhanes_clean`.

```{r descriptive-stats-BPSysAve-BPDiaAve}

```

**Дополнительно (необязательное задание)** Визуализируйте эти параметры. Используйте боксплот, свяжите линиями измерения одного пациента.

##### Задание 3.3

Выберите подходящий статистический тест для проверки гипотез из задания 3.1 и объясните свой выбор.

*(тут будет ответ студента)*

##### Задание 3.4

Используя выбранный тест, проверьте гипотезы из задания 3.1 на уровне значимости α = 0.1.

```{r test-BP}
# paired = TRUE указывает, что измерения парные
# test_BP <- ...
# 
# 
# print(test_BP)
```

##### Задание 3.5

Как p-значение и 90% доверительный интервал информируют вас о разнице измеренного систолического и диастолического артериального давления? Что вы можете сказать про статистическую значимость?

------------------------------------------------------------------------

## Непараметрические тесты

Допустим, мы хотим сравнить статистическое доминирование ИМТ, а не средние абсолютные значения

### 4: Сравнение ИМТ мужчин и женщин при помощи непараметрических тестов

Вопрос исследования: Отличаются ли превосходят ли как правило ИМТ ($\mathbf{BMI}$) у представителей одного пола относительно другого?

##### Задание 4.1

Сформулируйте нулевую и альтернативную гипотезы

\$H_0\$: *(ответ студента)*

\$H_a\$: *(ответ студента)*

##### Задание 4.2

Посчитайте ключевые статистики (количество пациентов в каждой группе и другие статистики по необходимости)

```{r descriptive-stats-IMT}

```

Объясните, почему выбор статистик отличается для этого сценария от сценариев 1, 2 и 3.

*(ответ студента)*


##### Задание 4.3

Обоснуйте, является ли тест Манна-Уитни подходящим для проверки гипотез из задания 4.1 и объясните свой выбор.

Имеет ли значение для выбора теста, сколько пациентов в каждой группе? Что, если бы в одной группе было бы 10 пациентов или меньше? А если 2 пациента?

Являются ли группы зависимыми или независимыми?

*(ответ студента)*

##### Задание 4.4

Проверьте гипотезы из задания 4.1 на уровне значимости α = 0.1. 

```{r bmi-gender-test}

bmi_gender_test <- ...


print(bmi_gender_test)

```

##### Задание 4.5

Как p-значение и 90% доверительный интервал информируют вас разнице между группами? Что вы можете сказать про статистическую значимость?



### 5 Разница между медианами САД и ДАД

Сценарий: Вопрос исследования: превосходят ли, как правило, значения одного типа артериального давления значения другого типа (САД vs. ДАД)? САД - систолическое артериальное давление, ДАД - диастолическое артериальное давление

##### Задание 5.1

Сформулируйте нулевую и альтернативную гипотезы

-   $H_0$: *(ответ студента)*
-   $H_a$: *(ответ студента)*

##### Задание 5.2

Посчитайте ключевые статистики для переменной `BPSysAve` и `BPDiaAve` в вашем чистом наборе данных `nhanes_clean`. Обратите внимание, что это иные статистики, чем в задании 3.

```{r descriptive-stats-pressure-alternative}

```

**Дополнительно (необязательное задание)** Визуализируйте эти параметры. Используйте violinplot и boxplot, свяжите линиями измерения одного пациента. Визуально оцените, как выглядит распределение обеих переменных

##### Задание 5.3

Выберите подходящий статистический тест для проверки гипотез из задания 5.1 и объясните свой выбор.

*(тут будет ответ студента)*

##### Задание 5.4

Используя выбранный тест, проверьте гипотезы из задания 5.1 на уровне значимости α = 0.1.

```{r test-BP}
# paired = TRUE указывает, что измерения парные
# test_BP <- ...
# 
# 
# print(test_BP)
```

##### Задание 5.5

Как p-значение и 90% доверительный интервал информируют вас о разнице измеренного систолического и диастолического артериального давления? Что вы можете сказать про статистическую значимость?

------------------------------------------------------------------------

# Тесты для категориальных данных

### 6: Поиск зависимости между физической активностью и проблемами со сном 

Вы хотите исследовать, есть ли взаимосвязь между проблемами со сном у человека и тем, занимается ли он физической активностью. Переменные: $\mathbf{PhysActive}$ --- бинарный признак (1 = активно занимается, 0 = не занимается), $\mathbf{SleepTrouble}$ --- бинарный признак (1 = есть проблемы со сном, 0 = нет проблем). 

#### Задания:

##### Задание 6.1

Сформулируйте нулевую и альтернативную гипотезы для проверки связи между физической активностью и проблемами со сном. Какую альтернативу вы используете --- одностороннюю или двустороннюю? Обоснуйте ответ

- $H_0$: *(ответ студента)* 
- $H_a$: *(ответ студента)*

##### Задание 6.2

Постройте таблицу сопряженности и визуализируйте ее. Исходя из полученной таблицы и иллюстрации, как вам кажется, похожи ли наши признаки на независимые? Почему? 

```{r}
#table(...)
#mosaicplot(...)
```

##### Задание 6.3

Какой статистический тест подходит для тестирования гипотезы из 6.1 (Хи-квадрат, Фишер, МакНемара)? Объясните свой выбор. Какие ограничения у выбранного теста? Если нужно, проверьте ограничения

*(ответ студента)* 

##### Задание 6.4

Используя выбранный тест, проверьте гипотезы из 6.1 на уровне значимости α = 0.05. Какое p-значение и значение статистики критерия получилось? Что вы можете сказать про статистическую значимость? 

Совпадает ли результат статистического анализа с вашим предположением в 6.2? Если нет, попробуйте объяснить почему

```{r}

```

##### Задание 6.5

Посчитайте размер эффекта (отношение шансов и отношение рисков, если это имеет смысл для этого исследования) двумя способами -- самостоятельно (посчитайте дроби исходя из таблицы сопряженности), и с помощью пакета epitools, сравните результаты. Проинтерпретируйте результат с точки зрения клинической значимости (не забудьте про 95% доверительный интервал!). Прокомментируйте, почему вы решили считать или не считать отношение рисков. 

```{r}

```

##### Задание 6.6

Исходя из результатов статистического анализа, можем ли мы сделать вывод, что физическая активность улучшает сон? Или что люди, которые лучше спят, чаще занимаются спортом? 

*(ответ студента)*



------------------------------------------------------------------------

# Поиск зависимостей между количественными / порядковыми признаками

### 7. Анализ зависимости между ростом и массой тела

Вопрос. Есть ли линейная связь между ростом (Height) и весом (Weight) у участников NHANES старше 18 лет?

#### Задание 7.1

Сформулируйте нулевую и альтернативную гипотезы.

-   $H_0$: 
-   $H_a$: 

#### Задание 7.2

Визуализируйте распределения анализируемых переменных. Визуально оцените форму распределений и наличие выбросов.

Постройте диаграмму рассеяния Height vs Weight (график должен быть читаемым), оцените линейность связи признаков.


#### Задание 7.3

Выберите подходящий статистический тест для проверки гипотезы из п. 7.1 и объясните свой выбор.

Используя выбранный тест, проверьте гипотезы из п. 7.1 на уровне значимости α = 0.05.

Оцените величину наблюдаемого эффекта.

#### Задание 7.4

Как p-значение и 95% доверительный интервал информируют вас о силе и направлении связи между ростом и весом? Что вы можете сказать про статистическую и практическую значимость результата?



### 8. Анализ зависимости между образованием и доходом

Вопрос. Существует ли связь между уровнем образования (Education) и доходом домохозяйства (HHIncome) у участников NHANES старше 18 лет?

#### Задание 8.1

Сформулируйте нулевую и альтернативную гипотезы.

-   $H_0$: 
-   $H_a$: 

#### Задание 8.2

Постройте диаграмму рассеяния, которая позволит визуализировать связь между изучаемыми переменными.

#### Задание 8.3

Выберите подходящий статистический тест для проверки гипотезы из п. 8.1 и объясните свой выбор.

Используя выбранный тест, проверьте гипотезы из п. 8.1 на уровне значимости α = 0.05.

Оцените величину наблюдаемого эффекта.

#### Задание 8.4

Как p-значение и значение коэффициента корреляции информируют вас о силе и направлении связи между уровнем образования и доходом домохозяйства? Что вы можете сказать про статистическую и практическую значимость результата?

